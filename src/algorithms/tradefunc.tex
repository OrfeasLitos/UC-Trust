\Suppressnumber
\begin{lstlisting}[label=tradefunc, style=numbers]
(*@$\mathcal{F}_{Trade}$ \Reactivatenumber@*)
Initialisation:
  (*@$\forall Alice \in \mathcal{P},$@*)
    assets((*@$Alice$@*)) = (*@$\bot$@*)

Upon receiving trade(ours, theirs, (*@$Bob$@*)) from (*@$Alice$@*):
  AliceOK = checkAvailability(ours, (*@$Alice$@*), (*@$Alice$@*))
  BobOK    = checkAvailability(theirs, (*@$Bob$@*), (*@$Alice$@*))
  If AliceOK and BobOK:
    transfer(ours, (*@$Alice$@*), (*@$Bob$@*))
    transfer(theirs, (*@$Bob$@*), (*@$Alice$@*))

checkAvailability(object, player, invoker):
  If object is money:
    If player has enough money:
      return True
    Else:
      Send notEnoughMoney(object, player) to invoker
      return False
  Else: # object is asset
    If object is in the list of player's assets:
      return True
    Else:
      Send assetUnavailable(object, player) to invoker
      return False

transfer(object, sender, receiver):
  If object is money:
    send pay(object, receiver) to (*@$\mathcal{F}_{Ledger}$@*) as sender
  Else: # object is asset
    send transfer(object, receiver) to (*@$\mathcal{F}_{Assets}$@*) as sender

Upon receiving obtain((*@$s$@*)) from (*@$Alice$@*):
  assets((*@$Alice$@*)) = assets((*@$Alice$@*))(*@$\cup \left\{s\right\}$@*)
  send message obtained((*@$s$@*)) to (*@$Alice$@*)

Upon receiving lose((*@$s$@*)) from (*@$Alice$@*):
  assets((*@$Alice$@*)) = assets((*@$Alice$@*))(*@$\setminus \left\{s\right\}$@*)
  send message lost((*@$s$@*)) to (*@$Alice$@*)
\end{lstlisting}
