\Suppressnumber
\begin{lstlisting}[label=satprot, style=numbers]
(*@$\Pi_{SAT}$ \Reactivatenumber@*)
Initalization:
  util = (*@$\bot$@*)

Upon receiving type((*@$t$@*)) from (*@$\mathcal{E}$@*):
  util = (*@$t$@*)

Upon receiving message satisfy((*@$d, L$@*)) from (*@$\mathcal{E}$@*):
  If util == (*@$\bot$@*):
    send message utilityNotSet() to (*@$\mathcal{E}$@*)
    go to Idle state
  aux = (*@$L$@*)
  While (aux (*@$\neq \emptyset$@*)):
    send message chooseBestSeller((*@$d$@*), aux) to (*@$\mathcal{F}_{Trust}$@*)
    wait for response1 from (*@$\mathcal{F}_{Trust}$@*)
    If response1 == bestSeller((*@$d, L, Bob$@*)):
      send message canYouSatisfy((*@$d$@*)) to (*@$Bob$@*)
      wait for response2 from (*@$Bob$@*)
      If response2 == IcanSatisfy((*@$d, x, s$@*)):
        If util(with (*@$s$@*), w/o (*@$x$@*)) > util(with (*@$x$@*), w/o (*@$s$@*)):
          send message trade((*@$x, s, Bob$@*)) to (*@$\mathcal{F}_{Trade}$@*)
          wait for response3 from (*@$\mathcal{F}_{Trade}$@*)
            If response3 == traded((*@$x, s, Bob$@*)):
              send message satisfied((*@$d, x, s, Bob$@*)) to (*@$\mathcal{F}_{Trust}$@*)
              send message satisfied((*@$d, L$@*)) to (*@$\mathcal{E}$@*)
              go to Idle state
            Else If response3 == cheated((*@$x, s$@*), (*@$Bob$@*)):
              send message cheated((*@$d, x, s, Bob$@*)) to (*@$\mathcal{F}_{Trust}$@*)
              send message cheated((*@$d, L$@*)) to (*@$\mathcal{E}$@*)
              go to Idle state
    Else: # if response1 == (*@$\bot$@*)
      send message unsatisfied((*@$d, L$@*)) to (*@$\mathcal{E}$@*)
      go to Idle state
    aux = aux (*@$\setminus \left\{Bob\right\}$@*)
  send message unsatisfied((*@$d, L$@*)) to (*@$\mathcal{E}$@*)

Upon receiving message obtain((*@$s$@*)) from (*@$\mathcal{E}$@*):
  send message obtain((*@$s$@*)) to (*@$\mathcal{F}_{Trade}$@*)
  wait for response from (*@$\mathcal{F}_{Trade}$@*)
  If response == obtained((*@$s$@*)):
    send message obtained((*@$s$@*)) to (*@$\mathcal{E}$@*)
  Else:
    send message notObtained((*@$s$@*)) to (*@$\mathcal{E}$@*)

Upon receiving message lose((*@$s$@*)) from (*@$\mathcal{E}$@*):
  send message lose((*@$s$@*)) to (*@$\mathcal{F}_{Trade}$@*)
  wait for response from (*@$\mathcal{F}_{Trade}$@*)
  If response == lost((*@$s$@*)):
    send message lost((*@$s$@*)) to (*@$\mathcal{E}$@*)
  Else:
    send message notLost((*@$s$@*)) to (*@$\mathcal{E}$@*)

Upon receiving message canYouSatisfy((*@$d$@*)) from (*@$Alice$@*):
  If util == (*@$\bot$@*):
    ignore request, go to Idle state
  If util(proposing to (*@$Alice$@*) to trade our (*@$s$@*) for her (*@$x$@*)) > util(not proposing):
    send message IcanSatisfy((*@$d, x, s$@*)) to (*@$Alice$@*) # (*@$x$@*) is the price
  Else:
    send message IcannotSatisfy((*@$d$@*)) to (*@$Alice$@*)

Upon receiving message payment((*@$x, s, Alice$@*)) from (*@$\mathcal{F}_{Trade}$@*):
  If util == (*@$\bot$@*):
    ignore request, go to Idle state
  If util(not cheating (*@$x, s, Alice$@*)) > util(cheating (*@$x, s, Alice$@*)):
    send message complete((*@$x, s, Alice$@*)) to (*@$\mathcal{F}_{Trade}$@*)
\end{lstlisting}
