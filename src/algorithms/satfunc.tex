\Suppressnumber
\begin{lstlisting}[label=satfunc, style=numbers]
(*@$\mathcal{F}_{\mathrm{SAT}}$ \Reactivatenumber@*)
# Commented lines are the weak version, (*@$\langle \mathcal{F}_{\mathrm{SAT}} \rangle$@*).
Initialisation:
  (*@$\forall Alice \in \mathcal{P},$@*)
    util((*@$Alice$@*)) = (*@$\bot$@*)
  # advBlacklistedBy = (*@$\emptyset$@*)

Upon receiving (type, (*@$t$@*)) from (*@$Alice$@*):
  util((*@$Alice$@*)) = (*@$t$@*)

# TODO: have adversary influence list only on weak F_SAT
# TODO: define dist(normalresponse, adversarialresponse)
Upon receiving (satisfy, (*@$d, L$@*)) from (*@$Alice$@*):
  If util((*@$Alice$@*)) == (*@$\bot$@*):
    send message (utilityNotSet) to (*@$Alice$@*)
    go to Idle state
  find list = (*@$\left\{\left(Bob, x, s\right) \in L \times \mathbb{R} \times Assets :\right.$@*)
    (*@$s \in$@*) assets((*@$Bob$@*)) and (*@$s \in d$@*) and (*@$x \geq 0$@*) and
    (*@$\mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Alice\right) \geq x$@*) and (*@\label{satfunc:hascoins}@*)
    util((*@$Alice$@*))((*@$\mathcal{G}_{\mathrm{Assets}}.\mathrm{possessions}\left(Alice\right) \cup \left\{s\right\},$@*) (*@\label{satfunc:gains:Alice:start}@*)
        (*@$\mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Alice\right) - x$@*)) >
    util((*@$Alice$@*))((*@$\mathcal{G}_{\mathrm{Assets}}.\mathrm{possessions}\left(Alice\right),
    \mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Alice\right)$@*)) (*@\label{satfunc:gains:Alice:end}@*)
    and
    util((*@$Bob$@*))((*@$\mathcal{G}_{\mathrm{Assets}}.\mathrm{possessions}\left(Bob\right) \setminus \left\{s\right\},$@*) (*@\label{satfunc:gains:Bob:start}@*)
        (*@$\mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Bob\right) + x$@*)) >
    util((*@$Bob$@*))((*@$\mathcal{G}_{\mathrm{Assets}}.\mathrm{possessions}\left(Bob\right),
    \mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Bob\right)$@*)) (*@\label{satfunc:gains:Bob:end}@*)
  # If (*@$Alice \in$@*) advBlacklistedBy:
  #   remove from list all entries with (*@$\mathcal{A}$@*) as seller
  # send (chooseBestSeller, (*@$d$@*), list, (*@$Alice$@*)) to (*@$\mathcal{A}$@*)
  # wait for response from (*@$\mathcal{A}$@*)
  # If response (*@$\neq$@*) (bestSeller, list, (*@$Bob, x, s$@*)), (*@$Bob \in \mathcal{P}, x \in Money, s \in Asset$@*): (*@\label{satfunc:badresponse}@*)
    # e.g. (*@$Bob = \bot$@*)
  ((*@$Bob, x, s$@*)) = (*@$\argmax\limits_{\left(Bob, x, s\right) \in \texttt{list}}\left\{\right.$@*)util((*@$Alice$@*))((*@$\mathcal{G}_{\mathrm{Assets}}.\mathrm{possessions}\left(Alice\right) \cup \left\{s\right\},$@*)
        (*@$\mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Alice\right) - x$@*))(*@$\left.\right\}$@*)
  # Else:
  #   parse response as (bestSeller, list, (*@$Bob, x, s$@*))
  #   ((*@$Bob', x', s'$@*)) = (*@$\argmax\limits_{\left(Bob, x, s\right) \in \texttt{list}}\left\{\right.$@*)util((*@$Alice$@*))((*@$\mathcal{G}_{\mathrm{Assets}}.\mathrm{possessions}\left(Alice\right) \cup \left\{s\right\},$@*)
  #      (*@$\mathcal{G}_{\mathrm{Ledger}}.\mathrm{balance}\left(Alice\right) - x$@*))(*@$\left.\right\}$@*)
  #   punish (*@$\mathcal{A}$@*) dist((*@$Bob, x, s$@*), (*@$Bob', x', s'$@*)) payoff reduction (*@\label{satfunc:punish}@*)
  send (pay, (*@$Alice$@*), (*@$Bob$@*), x) to (*@$\mathcal{G}_{\mathrm{Ledger}}$@*) as (*@$Alice$@*)
  # If (*@$Bob == \mathcal{A}$@*):
  #   send (cheat, list, response, (*@$Alice$@*)) to (*@$\mathcal{A}$@*)
  #   wait for response1 from (*@$\mathcal{A}$@*)
  #   If response1 == yes:
  #     advBlacklistedBy = advBlacklistedBy (*@$\cup \: Alice$@*) (grim trigger)
  #     send message (cheated, (*@$d, L$@*)) to (*@$Alice$@*) (*@\label{satfunc:send:cheated}@*)
  #     go to idle state
  send (give, (*@$Bob$@*), (*@$Alice$@*), s) to (*@$\mathcal{G}_{\mathrm{Assets}}$@*) as (*@$Bob$@*)
  send message (satisfied, (*@$d, L$@*)) to (*@$Alice$@*) (*@\label{satfunc:send:satisfied}@*)
\end{lstlisting}
