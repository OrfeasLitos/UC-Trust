\Suppressnumber
\begin{lstlisting}[label=satfunc, style=numbers]
(*@$\mathcal{F}_{\mathrm{SAT}}$ \Reactivatenumber@*)
Initialisation:
  (*@$\forall Alice \in \mathcal{P},$@*)
    util((*@$Alice$@*)) = (*@$\bot$@*)
    assets((*@$Alice$@*)) = (*@$\bot$@*)

Upon receiving (type, (*@$t$@*)) from (*@$Alice$@*):
  util((*@$Alice$@*)) = (*@$t$@*)

Upon receiving (satisfy, (*@$d, L$@*)) from (*@$Alice$@*):
  If util((*@$Alice$@*)) == (*@$\bot$@*):
    send message (utilityNotSet) to (*@$Alice$@*)
    go to Idle state
  find list = (*@$\left\{\left(Bob, x, s\right) \in L \times \mathbb{R} \times Assets :\right.$@*)
    (*@$s \in$@*) assets((*@$Bob$@*)) and (*@$s \in d$@*) and (*@$x \geq 0$@*) and
    (*@$Alice$@*) has at least (*@$x$@*) coins available and (*@\label{satfunc:hascoins}@*)
    util((*@$Alice$@*))((*@$state_{Alice} \cup s - x$@*)) > util((*@$Alice$@*))((*@$state_{Alice}$@*)) (*@\label{satfunc:gains:Alice}@*)
    and
    util((*@$Bob$@*))((*@$state_{Bob} \setminus s + x$@*)) (*@$\geq$@*) util((*@$Bob$@*))((*@$state_{Bob}$@*))(*@$\left.\right\}$@*) (*@\label{satfunc:gains:Bob}@*)
  send (chooseBestSeller, list, (*@$d$@*), (*@$Alice$@*)) to (*@$\mathcal{A}$@*)
  wait for response from (*@$\mathcal{A}$@*)
  If response (*@$\neq$@*) (bestSeller, list, (*@$Bob, x, s$@*)), (*@$Bob \in \mathcal{P}, x \in Money, s \in Asset$@*): (*@\label{satfunc:badresponse}@*)
    # e.g. (*@$Bob = \bot$@*)
    ((*@$Bob, x, s$@*)) = (*@$\argmax\limits_{\left(Bob, x, s\right) \in \texttt{list}}\left\{\right.$@*)util((*@$Alice$@*))((*@$state_{Alice} \cup s - x$@*))(*@$\left.\right\}$@*)
  Else:
    parse response as (bestSeller, list, (*@$Bob, x, s$@*))
  pay (*@$x$@*) from (*@$Alice$@*) to (*@$Bob$@*)
  assets((*@$Bob$@*)) = assets((*@$Bob$@*))(*@$\setminus \left\{s\right\}$@*)
  assets((*@$Alice$@*)) = assets((*@$Alice$@*))(*@$\cup \left\{s\right\}$@*)
  send message (satisfied, (*@$d, L$@*)) to (*@$Alice$@*) (*@\label{satfunc:send:satisfied}@*)

Upon receiving (obtain, (*@$s$@*)) from (*@$Alice$@*):
  assets((*@$Alice$@*)) = assets((*@$Alice$@*))(*@$\cup \left\{s\right\}$@*)
  send message (obtained, (*@$s$@*)) to (*@$Alice$@*)

Upon receiving (lose, (*@$s$@*)) from (*@$Alice$@*):
  assets((*@$Alice$@*)) = assets((*@$Alice$@*))(*@$\setminus \left\{s\right\}$@*)
  send message (lost, (*@$s$@*)) to (*@$Alice$@*)
\end{lstlisting}
